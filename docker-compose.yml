services:
 app:
  container_name: app
  build: ./docker/php
  # composerでprojectを作ったあとcdでproject内入らないと
  volumes:
   - .:/var/www
   - ./log:/var/log


 nginx:
  image: nginx
  container_name: nginx
  # localhost　->　Dockerコンテナ/tcp通信
  # 0.0.0.0:8000->80/tcp
  ports:
   - 8000:80
  volumes:
    - .:/var/www
    - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf
  working_dir: /var/www
  # nginx を　app　に依存させる（appが親、nginxが子）app → nginxの順に起動する
  depends_on:
   - app
   
 db:
   image: mysql:5.7
   container_name: db
   environment:
    MYSQL_ROOT_PASSWORD: root
    MYSQL_DATABASE: Laravel_test
    MYSQL_USER: db-user
    MYSQL_PASSWORD: db-pass
    TZ: 'Asia/Tokyo'
  #  command: mysqld --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
   volumes:
    - ./docker/db/data:/var/lib/mysql
    - ./docker/db/my.cnf:/etc/mysql/conf.d/my.cnf
    - ./docker/db/sql:/docker-entrypoint-initdb.d
   ports:
    - 3306:3306